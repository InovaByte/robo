<html><head><base href="https://www.binance.com/"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Bot de Sinais de Trading Binance Futures - EMA, RSI e Volume</title><style>
body {
  font-family: Arial, sans-serif;
  background-color: #f0f2f5;
  margin: 0;
  padding: 20px;
  color: #333;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  background-color: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h1 {
  color: #f0b90b;
  text-align: center;
}
.controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}
button {
  background-color: #f0b90b;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 4px;
}
.stats {
  display: flex;
  justify-content: space-between;
  background-color: #f8f9fa;
  padding: 10px;
  border-radius: 4px;
  margin-bottom: 20px;
}
.stat {
  text-align: center;
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #f0b90b;
}
#log {
  margin-top: 20px;
  height: 200px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  font-family: monospace;
}
#signals {
  margin-top: 20px;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 4px;
}
.signal {
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 4px;
}
.signal.buy {
  background-color: #d4edda;
  color: #155724;
}
.signal.sell {
  background-color: #f8d7da;
  color: #721c24;
}
#tradingview-widget-container {
  margin-bottom: 20px;
}
</style>
</head>
<body>
  <div class="container">
    <h1>Bot de Sinais de Trading Binance Futures - EMA, RSI e Volume</h1>
    <div class="controls">
      <button id="startBtn">Iniciar Bot</button>
      <button id="stopBtn">Parar Bot</button>
    </div>
    <div id="tradingview-widget-container"><div id="tradingview_b0f54-wrapper" style="position: relative; box-sizing: content-box; font-family: -apple-system, BlinkMacSystemFont, &quot;Trebuchet MS&quot;, Roboto, Ubuntu, sans-serif; margin: 0px auto !important; padding: 0px !important; width: 100%; height: 500px;"><iframe title="advanced chart TradingView widget" lang="en" id="tradingview_b0f54" frameborder="0" allowtransparency="true" scrolling="no" allowfullscreen="true" src="https://s.tradingview.com/widgetembed/?hideideas=1&amp;overrides=%7B%22paneProperties.background%22%3A%22%23ffffff%22%2C%22paneProperties.vertGridProperties.color%22%3A%22%23dfe6e9%22%2C%22paneProperties.horzGridProperties.color%22%3A%22%23dfe6e9%22%2C%22symbolWatermarkProperties.transparency%22%3A90%2C%22scalesProperties.textColor%22%3A%22%23999999%22%2C%22mainSeriesProperties.candleStyle.wickUpColor%22%3A%22%2334ae7a%22%2C%22mainSeriesProperties.candleStyle.wickDownColor%22%3A%22%23df5c4e%22%7D&amp;enabled_features=%5B%5D&amp;disabled_features=%5B%5D&amp;locale=br#%7B%22symbol%22%3A%22BINANCE%3ABTCUSDT%22%2C%22frameElementId%22%3A%22tradingview_b0f54%22%2C%22interval%22%3A%2215%22%2C%22hide_side_toolbar%22%3A%220%22%2C%22allow_symbol_change%22%3A%221%22%2C%22save_image%22%3A%221%22%2C%22studies%22%3A%22EMA%40tv-basicstudies%5Cu001fEMA%40tv-basicstudies%5Cu001fRSI%40tv-basicstudies%22%2C%22theme%22%3A%22light%22%2C%22style%22%3A%221%22%2C%22timezone%22%3A%22Etc%2FUTC%22%2C%22studies_overrides%22%3A%22%7B%5C%22moving%20average%20exponential.length%5C%22%3A50%2C%5C%22moving%20average%20exponential.1.length%5C%22%3A200%2C%5C%22relative%20strength%20index.length%5C%22%3A14%7D%22%2C%22utm_medium%22%3A%22widget%22%2C%22utm_campaign%22%3A%22chart%22%2C%22utm_term%22%3A%22BINANCE%3ABTCUSDT%22%2C%22page-uri%22%3A%22__NHTTP__%22%7D" style="width: 100%; height: 100%; margin: 0px !important; padding: 0px !important;"></iframe></div></div>
    <div class="stats">
      <div class="stat">
        <div>Sinais Gerados</div>
        <div id="signalsCount" class="stat-value">0</div>
      </div>
      <div class="stat">
        <div>Último Preço</div>
        <div id="lastPrice" class="stat-value">0 USDT</div>
      </div>
    </div>
    <div id="signals"></div>
    <div id="log"></div>
  </div>

<script>
window.onerror = function(message, source, lineno, colno, error) {
  console.error('Global error:', message, 'at', source, 'line', lineno, 'column', colno, 'Error object:', error);
  logMessage(`Erro global: ${message}`);
  return true;
};

let symbol = 'BTCUSDT';
const interval = '15m';
let leverage = 20;

let isRunning = false;
let ws;
let signalsCount = 0;
let prices = [];
let volumes = [];
let ema50 = [];
let ema200 = [];
let rsiValues = [];

function logMessage(message) {
  const logElement = document.getElementById('log');
  const logEntry = document.createElement('div');
  logEntry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
  logElement.appendChild(logEntry);
  logElement.scrollTop = logElement.scrollHeight;
}

document.addEventListener('DOMContentLoaded', function() {
  try {
    document.getElementById('startBtn').addEventListener('click', () => {
      if (!isRunning) {
        isRunning = true;
        logMessage('Iniciando bot...');
        runBot();
      }
    });

    document.getElementById('stopBtn').addEventListener('click', () => {
      if (isRunning) {
        isRunning = false;
        if (ws) ws.close();
        logMessage('Parando bot...');
      }
    });

    initTradingViewWidget(symbol);
  } catch (error) {
    console.error('Error during initialization:', error);
    logMessage(`Erro durante a inicialização: ${error.message}`);
  }
});

function initTradingViewWidget(initialSymbol) {
  new TradingView.widget({
    "width": "100%",
    "height": 500,
    "symbol": "BINANCE:" + initialSymbol,
    "interval": "15",
    "timezone": "Etc/UTC",
    "theme": "light",
    "style": "1",
    "locale": "br",
    "toolbar_bg": "#f1f3f6",
    "enable_publishing": false,
    "hide_side_toolbar": false,
    "allow_symbol_change": true,
    "studies": [
      "EMA@tv-basicstudies",
      "EMA@tv-basicstudies",
      "RSI@tv-basicstudies"
    ],
    "container_id": "tradingview-widget-container",
    "studies_overrides": {
      "moving average exponential.length": 50,
      "moving average exponential.1.length": 200,
      "relative strength index.length": 14
    },
    "overrides": {
      "paneProperties.background": "#ffffff",
      "paneProperties.vertGridProperties.color": "#dfe6e9",
      "paneProperties.horzGridProperties.color": "#dfe6e9",
      "symbolWatermarkProperties.transparency": 90,
      "scalesProperties.textColor": "#999999",
      "mainSeriesProperties.candleStyle.wickUpColor": "#34ae7a",
      "mainSeriesProperties.candleStyle.wickDownColor": "#df5c4e"
    },
    "saved_data": {
      "chartproperties": {
        "symbol": initialSymbol
      }
    },
    "onSymbolChange": function(symbol) {
      updateSymbol(symbol);
    }
  });
}

function updateSymbol(newSymbol) {
  symbol = newSymbol;
  resetBot();
  logMessage(`Símbolo alterado para ${symbol}`);
  if (isRunning) {
    runBot();
  }
}

function calculateEMA(data, period) {
  const k = 2 / (period + 1);
  let ema = data[0];
  const emaData = [ema];

  for (let i = 1; i < data.length; i++) {
    ema = (data[i] * k) + (ema * (1 - k));
    emaData.push(ema);
  }

  return emaData;
}

function calculateRSI(data, period = 14) {
  const changes = data.slice(1).map((value, index) => value - data[index]);
  const gains = changes.map(change => change > 0 ? change : 0);
  const losses = changes.map(change => change < 0 ? -change : 0);

  let avgGain = gains.slice(0, period).reduce((sum, gain) => sum + gain, 0) / period;
  let avgLoss = losses.slice(0, period).reduce((sum, loss) => sum + loss, 0) / period;

  const rsiData = [];
  for (let i = period; i < data.length; i++) {
    const rs = avgGain / avgLoss;
    const rsi = 100 - (100 / (1 + rs));
    rsiData.push(rsi);

    avgGain = ((avgGain * (period - 1)) + gains[i]) / period;
    avgLoss = ((avgLoss * (period - 1)) + losses[i]) / period;
  }

  return rsiData;
}

function generateSignal() {
  const lastPrice = prices[prices.length - 1];
  const lastEMA50 = ema50[ema50.length - 1];
  const lastEMA200 = ema200[ema200.length - 1];
  const lastRSI = rsiValues[rsiValues.length - 1];
  const lastVolume = volumes[volumes.length - 1];
  const prevVolume = volumes[volumes.length - 2];

  if (ema50[ema50.length - 2] <= ema200[ema200.length - 2] && lastEMA50 > lastEMA200 && lastRSI >= 30 && lastRSI <= 50 && lastVolume > prevVolume) {
    return 'buy';
  } else if (ema50[ema50.length - 2] >= ema200[ema200.length - 2] && lastEMA50 < lastEMA200 && lastRSI >= 50 && lastRSI <= 70 && lastVolume <= prevVolume) {
    return 'sell';
  }

  return null;
}

function displaySignal(signal, price) {
  const signalsElement = document.getElementById('signals');
  const signalElement = document.createElement('div');
  signalElement.classList.add('signal', signal);
  signalElement.innerHTML = `
    <strong>${signal.toUpperCase()}</strong> ${symbol} @ ${price} USDT
    <br>
    Data: ${new Date().toLocaleString()}
    <br>
    Volume: ${volumes[volumes.length - 1].toFixed(2)}
  `;
  signalsElement.insertBefore(signalElement, signalsElement.firstChild);
  
  if (signalsElement.children.length > 5) {
    signalsElement.removeChild(signalsElement.lastChild);
  }
  
  signalsCount++;
  document.getElementById('signalsCount').textContent = signalsCount;
}

async function runBot() {
  if (!isRunning) return;

  try {
    const response = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=${interval}&limit=300`);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    prices = data.map(candle => parseFloat(candle[4]));
    volumes = data.map(candle => parseFloat(candle[5]));

    ema50 = calculateEMA(prices, 50);
    ema200 = calculateEMA(prices, 200);
    rsiValues = calculateRSI(prices);

    if (ws) {
      ws.close();
    }
    ws = new WebSocket(`wss://fstream.binance.com/ws/${symbol.toLowerCase()}@kline_${interval}`);

    ws.onmessage = normalWebSocketHandler;

    ws.onerror = (error) => {
      console.error('WebSocket error:', error);
      logMessage(`Erro no WebSocket: ${error.message || 'Erro desconhecido'}`);
      isRunning = false;
    };

    ws.onclose = (event) => {
      console.log('WebSocket closed:', event);
      logMessage(`Conexão WebSocket fechada. Código: ${event.code}, Razão: ${event.reason || 'Não especificada'}`);
      isRunning = false;
    };

  } catch (error) {
    console.error('Error in runBot:', error);
    logMessage(`Erro ao executar o bot: ${error.message}`);
    if (error instanceof TypeError) {
      logMessage('Erro de rede. Verifique sua conexão com a internet.');
    }
    isRunning = false;
  }
}

function normalWebSocketHandler(event) {
  const message = JSON.parse(event.data);
  const candle = message.k;

  const price = parseFloat(candle.c);
  const volume = parseFloat(candle.v);

  prices.push(price);
  volumes.push(volume);

  ema50.push(calculateEMA(prices.slice(-50), 50).pop());
  ema200.push(calculateEMA(prices.slice(-200), 200).pop());
  rsiValues.push(calculateRSI(prices.slice(-15)).pop());

  document.getElementById('lastPrice').textContent = `${price} USDT`;

  const signal = generateSignal();
  if (signal) {
    displaySignal(signal, price);
    logMessage(`Sinal gerado: ${signal.toUpperCase()} ${symbol} @ ${price} USDT`);
  }
}

function resetBot() {
  if (ws) {
    ws.close();
  }
  signalsCount = 0;
  document.getElementById('signalsCount').textContent = signalsCount;
  document.getElementById('lastPrice').textContent = '0 USDT';
  prices = [];
  volumes = [];
  ema50 = [];
  ema200 = [];
  rsiValues = [];
  document.getElementById('signals').innerHTML = '';
  document.getElementById('log').innerHTML = '';
}
</script>
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<style>.tradingview-widget-copyright {font-size: 13px !important; line-height: 32px !important; text-align: center !important; vertical-align: middle !important; font-family: -apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif !important; color: #B2B5BE !important;} .tradingview-widget-copyright .blue-text {color: #2962FF !important;} .tradingview-widget-copyright a {text-decoration: none !important; color: #B2B5BE !important;} .tradingview-widget-copyright a:visited {color: #B2B5BE !important;} .tradingview-widget-copyright a:hover .blue-text {color: #1E53E5 !important;} .tradingview-widget-copyright a:active .blue-text {color: #1848CC !important;} .tradingview-widget-copyright a:visited .blue-text {color: #2962FF !important;}</style></body></html>
